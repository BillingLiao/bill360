<!DOCTYPE HTML>
<html>

	<head>
		<title>查票360后台管理系统</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<script type="application/x-javascript">
			addEventListener("load", function() {
				setTimeout(hideURLbar, 0);
			}, false);

			function hideURLbar() {
				window.scrollTo(0, 1);
			}
		</script>
		<link href="css/bootstrap.min.css" rel='stylesheet' type='text/css' />
		<!-- Custom Theme files -->
		<link href="css/style.css" rel='stylesheet' type='text/css' />
		<link href="css/font-awesome.css" rel="stylesheet">
		<script src="js/jquery.min.js">
		</script>
		<!-- Mainly scripts -->
		<script src="js/jquery.metisMenu.js"></script>
		<script src="js/jquery.slimscroll.min.js"></script>
		<!-- Custom and plugin javascript -->
		<link href="css/custom.css" rel="stylesheet">
		<script src="js/custom.js"></script>
		<script src="js/screenfull.js"></script>
		<script src="js/app.js" type="text/javascript" charset="utf-8"></script>
		<script>
			$(function() {
				$('#supported').text('Supported/allowed: ' + !!screenfull.enabled);

				if(!screenfull.enabled) {
					return false;
				}

				$('#toggle').click(function() {
					screenfull.toggle($('#container')[0]);
				});

			});
			var atoken = sessionStorage.getItem("atoken");
			var id = getQueryString("id");
			//判断atoken是否存在
			$(document).ready(function() {

				if(atoken == null || atoken.length == 0) {
					alert("请先登录");
					window.location.href = "signin.html?source=" + location.href.substr(location.href.lastIndexOf('/') + 1);
				}
				$("#username").text(sessionStorage.getItem("name"));
			});

			show_detail(id);

			function show_detail(id) {
				if(isNum(id)) {
					$.ajax({
						type: "post",
						url: api + "source/id",
						async: true,
						dataType: 'json',
						data: {
							id: id,
							atoken: atoken,
						},
						success: function(data) {
							if(data.code == 0) {
								var source = data.data;
								var id = source.id;
								var invoice = source.invoice;//收票企业
								var rebate = isString(source.rebate) ? source.rebate : "";//返佣
								var ename = isString(source.ename) ? source.ename : "";//背书公司名
								var eaccount = isString(source.eaccount) ? source.eaccount : "";//背书账号
								var isBargain = source.isBargain;//合同0-不是、1-是
								var isInvoice = source.isInvoice;//发票0-不是（默认）、1-是
								var etime = isNum(source.etime) ? source.etime : 0;//背书次数
								var remit = isString(source.remit) ? source.remit : "";//打款时间
								var nature = isString(source.nature) ? source.nature : "-";//资金性质
								var flow = isString(source.flow) ? source.flow : "";//流程
								var level = source.level;//优先级
								
								$("#source_id").html("<font style='color: black;'>"+id + "</font>");
								$("#source_invoice").html("<font style='color: black;'>"+invoice + "</font>");
								$("#source_rebate").val(rebate);
								$("#source_ename").val(ename);
								$("#source_eaccount").val(eaccount);
								$("#source_etime").val(etime);
								$("#source_remit").val(remit);
								$("#source_nature").val(nature);
								$("#source_flow").val(flow);
								$("#source_level").val(level);
								//当未指定是否是合同的时候，两个单选选项都不选中
								if(isNum(isBargain)) {
									if(isBargain == 0) {
										//不是合同
										$("#source_is_bargain").html('<label><input type="radio" name="add_bargain" id="souce_is_bargain_yes" value="1"> 是</label><label><input type="radio" name="add_bargain" id="souce_is_bargain_no" checked="checked" value="0"> 不是</label>');
									} else {
										//是合同
										$("#source_is_bargain").html('<label><input type="radio" name="add_bargain" id="souce_is_bargain_yes" value="1" checked="checked"> 是</label><label><input type="radio" name="add_bargain" id="souce_is_bargain_no" value="0"> 不是</label>');
									}
								} else {
									$("#source_is_bargain").html('<label><input type="radio" name="add_bargain" id="souce_is_bargain_yes" value="1"> 是</label><label><input type="radio" name="add_bargain" id="souce_is_bargain_no" value="0"> 不是</label>');
								}
								if(isNum(isInvoice)) {
									if(isInvoice == 0) {
										//不是发票	
										$("#source_is_invoice").html('<label><input type="radio" name="add_invoice" id="souce_is_invoice_yes" value="1"> 是</label><label><input type="radio" name="add_invoice" id="souce_is_invoice_no" checked="checked" value="0"> 不是</label>');
									} else {
										//是发票
										$("#source_is_invoice").html('<label><input type="radio" name="add_invoice" id="souce_is_invoice_yes" checked="checked" value="1"> 是</label><label><input type="radio" name="add_invoice" id="souce_is_invoice_no" value="0"> 不是</label>');
									}
								} else {
									//没有选择
									$("#source_is_invoice").html('<label><input type="radio" name="add_invoice" id="souce_is_invoice_yes" value="1"> 是</label><label><input type="radio" name="add_invoice" id="souce_is_invoice_no" value="0"> 不是</label>');
								}
								
								
							} else {
								alert(data.message);
							}
						},
						error: function(data) {
							console.log("系统错误");
							console.log(data);
						}
					});
				} else {
					alert("网络错误");
					window.location.href = "index.html";
				}

			}
			function save() {
				if(isNum(id)) {
					var isBargain = $("input[name='add_bargain']:checked").val();
					var isInvoice = $("input[name='add_invoice']:checked").val();
					if(!isNum(isBargain)) isBargain = "";
					if(!isNum(isInvoice)) isInvoice = "";
					$.ajax({
						type:"post",
						url:api + "source/set",
						async:true,
						dataType: 'json',
						data: {
							atoken: atoken,
							id: id,
							rebate: $("#source_rebate").val(),
							ename: $("#source_ename").val(),
							eaccount: $("#source_eaccount").val(),
							isBargain: isBargain,
							isInvoice: isInvoice,
							etime: $("#source_etime").val(),
							remit: $("#source_remit").val(),
							nature: $("#source_nature").val(),
							flow: $("#source_flow").val(),
							level: $("#source_level").val(),
						},
						success: function(data) {
							if(data.code == 0) {
								alert("修改成功");
								window.opener.location.reload();
								//location.reload();
								window.close();
								//location.reload();
							} else {
								alert(data.message);
							}
						},
						error: function(data) {
							console.log("系统错误");
							console.log(data);
						}
					});
				} else {
					alert("网络错误");
					window.location.href = "index.html";
				}
			}
		</script>
	</head>

	<body>
		<div id="wrapper">

			<!----->
			<nav class="navbar-default navbar-static-top" role="navigation">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
					<h1> <a class="navbar-brand" href="index.html">查票360</a></h1>
				</div>
				<div class=" border-bottom">

					<!-- Brand and toggle get grouped for better mobile display -->

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="drop-men">
						<ul class=" nav_1">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle dropdown-at" data-toggle="dropdown"><span class=" name-caret"><span id="username"></span></span><img src="images/wo.png"></a>
							</li>
						</ul>
					</div>
					<!-- /.navbar-collapse -->
					<div class="clearfix">

					</div>

					<div class="navbar-default sidebar" role="navigation">
						<div class="sidebar-nav navbar-collapse">
							<ul class="nav" id="side-menu">
								<li>
									<a href="index.html" class=" hvr-bounce-to-right"><i class="fa fa-dashboard nav_icon "></i><span class="nav-label">数据字典</span> </a>
								</li>

								 <li>
			                        <a href="#" class=" hvr-bounce-to-right"><i class="fa fa-sitemap nav_icon"></i>收票清单管理<span class="fa arrow"></span></a>
			                        <ul class="nav nav-second-level">
			                            <li>
			                                <a href="staff.html" class=" hvr-bounce-to-right"><i class="fa fa-user nav_icon"></i>对接人信息</a>
			                            </li>
			                            <li>
			                                <a href="bill.html" class=" hvr-bounce-to-right"><i class="fa fa-table nav_icon"></i>对接人收票清单</a>
			                            </li>
			                            <li>
			                                <a href="acceptance.html" class=" hvr-bounce-to-right"><i class="fa fa-qrcode nav_icon"></i>承兑企业信息</a>
			                                	
			                            </li>
			                        </ul>
			                    </li>
			                    
								<li>
									<a href="#" class=" hvr-bounce-to-right"><i class="fa fa-sitemap nav_icon"></i>持票库存管理<span class="fa arrow"></span></a>
										<ul class="nav nav-second-level">
			                            <li>
			                                <a href="userByAdmin.html" class=" hvr-bounce-to-right"><i class="fa fa-user nav_icon"></i>用户信息</a>
			                            </li>
			                            <li>
			                                <a href="inventory.html" class=" hvr-bounce-to-right"><i class="fa fa-dashboard nav_icon"></i>持票清单</a>
			                            </li>
			                        </ul>
								</li>
								<li>
									<a href="order.html" class=" hvr-bounce-to-right"><i class="fa fa-television nav_icon"></i> <span class="nav-label">业务订单管理</span> </a>
								</li>

								<li>
									<a href="os.html" class=" hvr-bounce-to-right"><i class="fa fa-table nav_icon"></i> <span class="nav-label">系统管理</span> </a>
								</li>
							</ul>
						</div>
					</div>
			</nav>
			<div id="page-wrapper" class="gray-bg dashbard-1">
				<div class="content-main">

					<!--banner-->
					<div class="banner">
						<h2>
							<a href="index.html">Home</a>
							<i class="fa fa-angle-right"></i>
							<span>收票企业详情</span>
						</h2>
					</div>

					<div class=" profile">
						<div class="profile-bottom" style="min-height: 800px; padding: 10px;">
							<table class="table table-bordered">
								<tbody>

									<tr>
										<td width="15%">编号</td>
										<td width="85%"><span id="source_id"></span></td>
									</tr>
									<tr>
										<td>收票企业</td>
										<td width="85%"><span id="source_invoice"></span></td>
									</tr>
									<tr>
										<td>返佣</td>
										<td><input class="form-control" id="source_rebate" placeholder="请输入返佣" type="text"></td>
									</tr>
									<tr>
										<td>背书公司名</td>
										<td><input class="form-control" id="source_ename" placeholder="请输入背书公司名" type="text"></td>
									</tr>
									<tr>
										<td>背书账号</td>
										<td><input class="form-control" id="source_eaccount" placeholder="请输入背书账号" type="text"></td>
									</tr>
									<tr>
										<td>合同</td>
										<td id="source_is_bargain">
											
										</td>
									</tr>
									<tr>
										<td>发票</td>
										<td id="source_is_invoice">
										</td>
									</tr>
									<tr>
										<td>背书次数</td>
										<td>
											<input class="form-control" id="source_etime" placeholder="请输入背书次数" type="number">
										</td>
									</tr>
									<tr>
										<td>打款时间</td>
										<td>
											<input class="form-control" id="source_remit" placeholder="请输入打款时间" type="date">
										</td>
									</tr>
									<tr>
										<td>资金性质</td>
										<td>
											<input class="form-control" id="source_nature" placeholder="请输入资金性质" type="text">
										</td>
									</tr>
									<tr>
										<td>流程</td>
										<td>
											<input class="form-control" id="source_flow" placeholder="请输入流程" type="text">
										</td>
									</tr>
									<tr>
										<td>优先级</td>
										<td>
											<input class="form-control" id="source_level" placeholder="优先级0~10" type="number" max="10">
										</td>
									</tr>
									<tr class="traa">
										<td colspan="2" style="text-align: right;">
											<button type="button" class="btn btn-primary" onclick="save()">保存</button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>

					<div class="copy">
						<p> &copy; 2018 查票360. All Rights Reserved | Power by
							<a href="http://wenxikeji.com/" target="_blank">wenxikeji.com</a>
						</p>
					</div>
				</div>
				<div class="clearfix"> </div>
			</div>
			</div>
			<!---->
			<!--scrolling js-->
			<script src="js/jquery.nicescroll.js"></script>
			<script src="js/scripts.js"></script>
			<!--//scrolling js-->
			<script src="js/bootstrap.min.js">
			</script>
	</body>

</html>